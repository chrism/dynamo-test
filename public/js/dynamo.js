// Generated by CoffeeScript 1.6.1
(function() {

  jQuery(function() {
    var dynamo_config_url, getConfig, getData, index, length, mediaNature, poll, pollCount, processData, server, token;
    index = 1;
    length = 21;
    mediaNature = 'IMAGE';
    server = '';
    token = '';
    pollCount = 0;
    dynamo_config_url = "/connection";
    poll = function() {
      return setTimeout(getData, 5000);
    };
    getConfig = function() {
      var request;
      request = $.get(dynamo_config_url);
      request.fail(function(jqXHR, textStatus, errorThrown) {
        return $('#dynamo-loading').text("Problem loading config: " + errorThrown + ".");
      });
      return request.done(function(data) {
        $('#dynamo-loading').text("Loading data...");
        server = $(data).find("config > server").attr("href");
        token = $(data).find("config > token").text();
        return getData();
      });
    };
    getData = function() {
      var dynamo_api_url, request;
      dynamo_api_url = "http://api." + server + "/v2.0/?method=ml.account.medias.list&token=" + token + "&index=" + index + "&length=" + length + "&mediaNature=" + mediaNature;
      request = $.get(dynamo_api_url);
      request.done(function(data) {
        return processData(data);
      });
      return request.fail(function(jqXHR, textStatus, errorThrown) {
        return $('#dynamo-loading').text("Problem loading data: " + errorThrown + ".");
      });
    };
    processData = function(data) {
      var column, eachImage, i, url, _i, _len, _ref;
      pollCount += 1;
      $('#dynamo-loading').text("Successfully loaded data " + pollCount + " times.");
      console.log(data);
      $("#column_1, #column_2, #column_3, #column_4").empty();
      _ref = $(data).find("image");
      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
        eachImage = _ref[i];
        console.log($(eachImage).attr('urlOriginalFile'));
        url = i < 1 ? $(eachImage).attr('url') : $(eachImage).attr('urlThumbnail');
        column = i < 3 ? 1 : i < 7 ? 2 : i < 14 ? 3 : 4;
        $("#column_" + column).append("<div><img id='id_" + i + "' src='" + url + "' /></div>");
      }
      return poll();
    };
    return getConfig();
  });

}).call(this);
