// Generated by CoffeeScript 1.6.1
(function() {

  jQuery(function() {
    var dynamo_api_url, dynamo_config_url, getConfig, getData, index, length, mediaNature, poll, pollCount, processData, server, token;
    index = 1;
    length = 21;
    mediaNature = 'IMAGE';
    server = 'memory-life.com';
    token = '97be50d4-80c8-422b-b91f-53c5ce5d0020';
    pollCount = 0;
    dynamo_config_url = "http://rmn.memory-life.com/Connect/?msidn=prod";
    dynamo_api_url = "http://api." + server + "/v2.0/?method=ml.account.medias.list&token=" + token + "&index=" + index + "&length=" + length + "&mediaNature=" + mediaNature;
    getConfig = function() {
      var request;
      request = $.get("http://rmn.memory-life.com/Connect/?msidn=prod");
      request.done(function(data) {
        return getData(data);
      });
      return request.fail(function(jqXHR, textStatus, errorThrown) {
        return $('#dynamo-loading').text("Problem loading config: " + errorThrown + ".");
      });
    };
    poll = function() {
      return setTimeout(getData, 5000);
    };
    getData = function() {
      var request;
      request = $.get(dynamo_api_url);
      request.done(function(data) {
        return processData(data);
      });
      return request.fail(function(jqXHR, textStatus, errorThrown) {
        return $('#dynamo-loading').text("Problem loading data: " + errorThrown + ".");
      });
    };
    processData = function(data) {
      var column, eachImage, i, url, _i, _len, _ref;
      pollCount += 1;
      $('#dynamo-loading').text("Successfully loaded data " + pollCount + " times.");
      $("#column_1, #column_2, #column_3, #column_4").empty();
      _ref = $(data).find("image");
      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
        eachImage = _ref[i];
        url = i < 1 ? $(eachImage).attr('url') : $(eachImage).attr('urlThumbnail');
        column = i < 3 ? 1 : i < 7 ? 2 : i < 14 ? 3 : 4;
        $("#column_" + column).append("<div><img id='id_" + i + "' src='" + url + "' /></div>");
      }
      return poll();
    };
    return getData();
  });

}).call(this);
